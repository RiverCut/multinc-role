
<ion-header>

  <ion-navbar color="primary">
    <ion-title>Multinc Role - {{ username }}</ion-title>
  </ion-navbar>

</ion-header>


<ion-content>
  <ion-row>
    <ion-col no-padding class="game-area">

      <ion-row no-padding class="chat-header">
        <ion-col no-padding>
          <ion-toolbar color="tertiary">
            <ion-title *ngIf="!inGame">Play - {{ allRoomInfo.length }} Games Open</ion-title>
            <ion-title *ngIf="inGame">Playing Game - {{ gameState.leader }}'s Game (Floor {{ gameState ? gameState.currentStep + 1 :  1}})</ion-title>
          </ion-toolbar>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="!inGame">
        <ion-col>
          <button ion-button color="primary" (click)="joinGame(null, true)" block>Start New Game</button>
        </ion-col>
        <ion-col>
          <button ion-button color="primary" disabled block>My Profile</button>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="inGame && !gameState.adventureStarted" class="game-buttons-area">
        <ion-col>
          <button ion-button color="primary" [disabled]="!isLeader" (click)="startGame()" block>Begin Adventure ({{ gameState.players.length }}/4)</button>
        </ion-col>
        <ion-col>
          <button ion-button color="primary" (click)="quitGame()" block>Leave Group</button>
        </ion-col>
      </ion-row>


      <ion-row *ngIf="inGame && !gameState.adventureStarted" padding class="game-content-area">
        <ion-col>
          <div class="blank-slate small" *ngIf="isLeader">
            Start the game when your party is ready.
          </div>
          <div class="blank-slate small" *ngIf="!isLeader">
            Wait for the leader to start the game.
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="inGame && gameState.adventureStarted" padding class="game-player-area">
        <ion-col col-3 *ngFor="let monster of gameState.currentMonsters" class="player" (click)="target(monster.id)">
          <div class="sprite-container">
            <span class="adds" *ngIf="monster.attack || monster.defense">
              +{{ monster.attack }}A / +{{ monster.defense }}D
            </span>
            <sprite [name]="'ENEMY_'+monster.spriteKey"></sprite>
          </div>
          <div>
            <h6>{{ monster.name }} (Lv. {{ monster.level }})</h6>
          </div>
          <div *ngIf="monster.hp > 0">
            {{ monster.hp }} / {{ monster.maxHp }}
          </div>
          <div *ngIf="monster.hp <= 0">
            DEAD
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="inGame && gameState.adventureStarted" padding class="game-content-area">
        <ion-col>
          <div class="blank-slate smaller">
            {{ gameState.status }}
          </div>
        </ion-col>
      </ion-row>

      <ion-row *ngIf="inGame" padding class="game-player-area">
        <ion-col col-3 *ngFor="let player of gameState.players" class="player" (click)="target(player.id)">
          <div class="sprite-container-container">

            <div class="sprite-container">
              <span class="adds" *ngIf="player.attack || player.defense">
                +{{ player.attack }}A/{{ player.defense }}D
              </span>
              <sprite [name]="'PLAYER_'+player.style.toUpperCase()"></sprite>
            </div>

            <div class="sprite-container">
              <span class="check" *ngIf="gameState.playerTargets[player.name]">
                <ion-icon name="checkmark"></ion-icon>
              </span>
              <action-sprite [name]="gameState.playerActions[player.name]"></action-sprite>
            </div>

          </div>

          <div>
            <h6>{{ player.name }} (Lv. {{ player.levels[player.style] }})</h6>
          </div>

          <div *ngIf="player.hp > 0">
            {{ player.hp }} / {{ player.maxHp }}
          </div>

          <div *ngIf="player.hp <= 0">
            DEAD
          </div>

        </ion-col>
      </ion-row>

      <ion-row *ngIf="inGame" class="adventure-log">
        <ion-col>
          <ion-row *ngFor="let logMessage of gameState.adventureLog">
            <ion-col>{{ logMessage }}</ion-col>
          </ion-row>
        </ion-col>
      </ion-row>

      <ion-row no-padding *ngIf="!inGame && !hasRoomInfo">
        <div class="blank-slate">
          No games have been started yet. <button ion-button color="primary" (click)="joinGame(null, true)">Start one!</button>
        </div>
      </ion-row>

      <ion-row no-padding *ngIf="!inGame && hasRoomInfo" class="game-list-container">
        <ion-col col-6 *ngFor="let info of allRoomInfo">
          <ion-card>
            <ion-card-header>
              {{ info.leader }}'s Game
            </ion-card-header>

            <ion-card-content>
              Players: {{ info.players }}/4
            </ion-card-content>

            <ion-row>
              <ion-col>
                <button ion-button block small color="secondary" (click)="joinGame(info.id)">Join Game</button>
              </ion-col>
            </ion-row>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-col>

    <ion-col no-padding class="chat-area" *ngIf="state">

      <ion-row no-padding class="chat-header">
        <ion-col no-padding>
          <ion-toolbar color="secondary">
            <ion-title>Chat - {{ state.lobby.users.length }} users online</ion-title>
          </ion-toolbar>
        </ion-col>
      </ion-row>

      <ion-row no-padding class="chat-output" #scrollArea>
        <div class="message" *ngFor="let message of state.lobby.messages">
          <span class="timestamp">{{ message.timestamp | date:'short' }}</span>
          <span class="sender">{{ message.sender }}</span>
          <span class="message">{{ message.message }}</span>
        </div>
      </ion-row>

      <ion-row no-padding class="chat-input">
        <ion-col no-padding col-10>
          <ion-input [(ngModel)]="currentMessage" placeholder="Send a message..." (keyup.enter)="sendMessage()"></ion-input>
        </ion-col>

        <ion-col col-2 class="send-container">
          <button ion-button color="primary" block (click)="sendMessage()">Send</button>
        </ion-col>
      </ion-row>

    </ion-col>

  </ion-row>
</ion-content>
